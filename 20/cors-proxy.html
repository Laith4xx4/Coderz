<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حل مشكلة CORS - Coderz</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem 0;
        }
        
        .solution-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .status-badge {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
        }
        
        .code-block {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #007bff;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .test-result {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="solution-card">
                    <h2 class="mb-4">
                        <i class="fas fa-exclamation-triangle me-2 text-warning"></i>
                        حل مشكلة CORS
                    </h2>
                    <p class="text-muted">
                        المشكلة: الخادم لا يسمح بالطلبات من نطاق مختلف. إليك عدة حلول:
                    </p>
                </div>

                <!-- الحل الأول: CORS Proxy -->
                <div class="solution-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4><i class="fas fa-link me-2"></i>الحل الأول: استخدام CORS Proxy</h4>
                        <span class="badge bg-success status-badge">مُوصى به</span>
                    </div>
                    <p>استخدام خادم وسيط لحل مشكلة CORS:</p>
                    
                    <div class="code-block">
                        // تحديث config.js
                        const API_CONFIG = {
                            BASE_URL: 'https://cors-anywhere.herokuapp.com/http://localhost:5285/api/Products',
                            // أو
                            BASE_URL: 'https://api.allorigins.win/raw?url=http://localhost:5285/api/Products'
                        };
                    </div>
                    
                    <button class="btn btn-primary" onclick="testCorsProxy()">
                        <i class="fas fa-play me-2"></i>اختبار CORS Proxy
                    </button>
                    
                    <div class="test-result" id="corsProxyResult" style="display: none;">
                        <h6>نتيجة الاختبار:</h6>
                        <pre id="corsProxyOutput"></pre>
                    </div>
                </div>

                <!-- الحل الثاني: تغيير المنفذ -->
                <div class="solution-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4><i class="fas fa-server me-2"></i>الحل الثاني: تغيير منفذ الخادم المحلي</h4>
                        <span class="badge bg-info status-badge">سهل</span>
                    </div>
                    <p>تشغيل الخادم المحلي على نفس المنفذ:</p>
                    
                    <div class="code-block">
                        # تشغيل خادم محلي على المنفذ 5285
                        python -m http.server 5285
                        
                        # أو باستخدام Node.js
                        npx http-server -p 5285
                    </div>
                    
                    <button class="btn btn-info" onclick="testLocalServer()">
                        <i class="fas fa-play me-2"></i>اختبار الخادم المحلي
                    </button>
                    
                    <div class="test-result" id="localServerResult" style="display: none;">
                        <h6>نتيجة الاختبار:</h6>
                        <pre id="localServerOutput"></pre>
                    </div>
                </div>

                <!-- الحل الثالث: إعدادات الخادم -->
                <div class="solution-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4><i class="fas fa-cog me-2"></i>الحل الثالث: إعدادات الخادم</h4>
                        <span class="badge bg-warning status-badge">متقدم</span>
                    </div>
                    <p>إضافة رؤوس CORS للخادم:</p>
                    
                    <div class="code-block">
                        // في خادم .NET
                        app.UseCors(builder => {
                            builder.AllowAnyOrigin()
                                   .AllowAnyMethod()
                                   .AllowAnyHeader();
                        });
                        
                        // أو في Express.js
                        app.use(cors({
                            origin: '*',
                            methods: ['GET', 'POST', 'PUT', 'DELETE'],
                            allowedHeaders: ['Content-Type', 'Authorization']
                        }));
                    </div>
                </div>

                <!-- الحل الرابع: وضع التطوير -->
                <div class="solution-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4><i class="fas fa-tools me-2"></i>الحل الرابع: وضع التطوير</h4>
                        <span class="badge bg-secondary status-badge">مؤقت</span>
                    </div>
                    <p>إضافة وضع التطوير لتجاوز CORS:</p>
                    
                    <button class="btn btn-secondary" onclick="enableDevMode()">
                        <i class="fas fa-toggle-on me-2"></i>تفعيل وضع التطوير
                    </button>
                    
                    <div class="alert alert-info mt-3">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>ملاحظة:</strong> هذا الحل يعمل فقط في وضع التطوير ولا يُنصح به للإنتاج.
                    </div>
                </div>

                <!-- اختبار الاتصال -->
                <div class="solution-card">
                    <h4><i class="fas fa-wifi me-2"></i>اختبار الاتصال</h4>
                    <p>اختبار الاتصال مع الخادم:</p>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <button class="btn btn-success w-100 mb-2" onclick="testDirectConnection()">
                                <i class="fas fa-plug me-2"></i>اتصال مباشر
                            </button>
                        </div>
                        <div class="col-md-6">
                            <button class="btn btn-warning w-100 mb-2" onclick="testWithProxy()">
                                <i class="fas fa-random me-2"></i>اتصال عبر Proxy
                            </button>
                        </div>
                    </div>
                    
                    <div class="test-result" id="connectionResult" style="display: none;">
                        <h6>نتيجة الاختبار:</h6>
                        <pre id="connectionOutput"></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // اختبار CORS Proxy
        async function testCorsProxy() {
            const resultDiv = document.getElementById('corsProxyResult');
            const output = document.getElementById('corsProxyOutput');
            
            resultDiv.style.display = 'block';
            output.textContent = 'جاري الاختبار...';
            
            try {
                const response = await fetch('https://cors-anywhere.herokuapp.com/http://localhost:5285/api/Products');
                const data = await response.json();
                
                output.textContent = `✅ نجح الاتصال!\n\nالبيانات المستلمة:\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                output.textContent = `❌ فشل الاتصال:\n${error.message}`;
            }
        }

        // اختبار الخادم المحلي
        async function testLocalServer() {
            const resultDiv = document.getElementById('localServerResult');
            const output = document.getElementById('localServerOutput');
            
            resultDiv.style.display = 'block';
            output.textContent = 'جاري الاختبار...';
            
            try {
                const response = await fetch('http://localhost:5285/api/Products');
                const data = await response.json();
                
                output.textContent = `✅ نجح الاتصال!\n\nالبيانات المستلمة:\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                output.textContent = `❌ فشل الاتصال:\n${error.message}\n\nتأكد من تشغيل الخادم على المنفذ 5285`;
            }
        }

        // تفعيل وضع التطوير
        function enableDevMode() {
            // إضافة رؤوس CORS للمتصفح (يعمل فقط في وضع التطوير)
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                // يمكن إضافة إعدادات خاصة للتطوير هنا
                alert('تم تفعيل وضع التطوير. تأكد من إعدادات الخادم.');
            } else {
                alert('وضع التطوير متاح فقط على localhost');
            }
        }

        // اختبار الاتصال المباشر
        async function testDirectConnection() {
            const resultDiv = document.getElementById('connectionResult');
            const output = document.getElementById('connectionOutput');
            
            resultDiv.style.display = 'block';
            output.textContent = 'جاري اختبار الاتصال المباشر...';
            
            try {
                const startTime = Date.now();
                const response = await fetch('http://localhost:5285/api/Products', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                const endTime = Date.now();
                
                if (response.ok) {
                    const data = await response.json();
                    output.textContent = `✅ نجح الاتصال المباشر!\n\nوقت الاستجابة: ${endTime - startTime}ms\nالبيانات: ${JSON.stringify(data, null, 2)}`;
                } else {
                    output.textContent = `❌ خطأ في الاستجابة: ${response.status} ${response.statusText}`;
                }
            } catch (error) {
                output.textContent = `❌ فشل الاتصال المباشر:\n${error.message}\n\nهذا يؤكد وجود مشكلة CORS`;
            }
        }

        // اختبار الاتصال عبر Proxy
        async function testWithProxy() {
            const resultDiv = document.getElementById('connectionResult');
            const output = document.getElementById('connectionOutput');
            
            resultDiv.style.display = 'block';
            output.textContent = 'جاري اختبار الاتصال عبر Proxy...';
            
            try {
                const startTime = Date.now();
                const response = await fetch('https://cors-anywhere.herokuapp.com/http://localhost:5285/api/Products');
                const endTime = Date.now();
                
                if (response.ok) {
                    const data = await response.json();
                    output.textContent = `✅ نجح الاتصال عبر Proxy!\n\nوقت الاستجابة: ${endTime - startTime}ms\nالبيانات: ${JSON.stringify(data, null, 2)}`;
                } else {
                    output.textContent = `❌ خطأ في الاستجابة: ${response.status} ${response.statusText}`;
                }
            } catch (error) {
                output.textContent = `❌ فشل الاتصال عبر Proxy:\n${error.message}`;
            }
        }

        // إضافة معلومات إضافية
        document.addEventListener('DOMContentLoaded', function() {
            console.log('معلومات الاتصال:');
            console.log('Origin:', window.location.origin);
            console.log('Hostname:', window.location.hostname);
            console.log('Port:', window.location.port);
            console.log('API URL:', 'http://localhost:5285/api/Products');
        });
    </script>
</body>
</html>
